(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-8534e7fc"],{"01ea":function(t,e){t.exports={LIMIT_UPLOAD_SIZE:5}},"08f3":function(t,e,i){"use strict";i.d(e,"a",(function(){return n})),i.d(e,"b",(function(){return r})),i.d(e,"c",(function(){return l}));var a=function(t,e){return{key:t,value:e}},n=[a(-1,"已删除"),a(0,"待审核"),a(1,"正常"),a(2,"审核未通过"),a(3,"隐藏")],r=[a(0,"封禁"),a(1,"正常")],l=[a(0,"隐藏"),a(1,"显示")]},"16b3":function(t,e,i){},2909:function(t,e,i){"use strict";function a(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,a=new Array(e);i<e;i++)a[i]=t[i];return a}function n(t){if(Array.isArray(t))return a(t)}function r(t){if("undefined"!==typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}function l(t,e){if(t){if("string"===typeof t)return a(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?a(t,e):void 0}}function s(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function o(t){return n(t)||r(t)||l(t)||s()}i.d(e,"a",(function(){return o}))},"333b":function(t,e,i){"use strict";i("40f1")},"40f1":function(t,e,i){},6247:function(t,e,i){"use strict";var a=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"selectImage"},[t.imgList.length?i("div",t._l(t.imgList,(function(e,a){return i("div",{key:a,staticClass:"imgBox",on:{click:function(e){t.visible=!0}}},[i("el-image",{staticClass:"smallImg",attrs:{src:t._f("imgUrl")(e),fit:"contain"}})],1)})),0):i("div",{staticClass:"imgBox",on:{click:function(e){t.visible=!0}}},[i("i",{staticClass:"el-icon-plus"})]),i("el-dialog",{attrs:{title:"选择图片",visible:t.visible,"append-to-body":""},on:{"update:visible":function(e){t.visible=e}}},[i("el-tabs",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],on:{"tab-click":t.handleTabClick},model:{value:t.activeTab,callback:function(e){t.activeTab=e},expression:"activeTab"}},[i("el-tab-pane",{attrs:{label:"外链图片",name:"link"}},[i("el-input",{attrs:{placeholder:"请输入图片外链地址",size:"medium"},model:{value:t.linkImgUrl,callback:function(e){t.linkImgUrl=e},expression:"linkImgUrl"}})],1),i("el-tab-pane",{attrs:{label:"上传图片",name:"upload"}},[i("el-upload",{ref:"upload",attrs:{action:t.HOST+"/api/user/upload/image",name:"files",accept:"image/jpeg,image/png,image/gif,image/jpg,image/bmp",headers:t.headers,"list-type":"picture-card","auto-upload":!1,limit:t.uploadLimit,"on-change":t.handleOnChange,"on-preview":t.handlePictureCardPreview,"on-success":t.handleUploadSuccess,"on-error":t.handleUploadFail}},[i("i",{staticClass:"el-icon-plus",attrs:{slot:"default"},slot:"default"})])],1),i("el-tab-pane",{attrs:{label:"素材库",name:"store"}})],1),i("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{on:{click:t.cancel}},[t._v("取 消")]),i("el-button",{attrs:{type:"primary"},on:{click:t.confirm}},[t._v("确 定")])],1)],1),i("el-dialog",{attrs:{visible:t.dialogVisible,"append-to-body":""},on:{"update:visible":function(e){t.dialogVisible=e}}},[i("img",{attrs:{width:"100%",src:t.dialogImageUrl,alt:""}})])],1)},n=[],r=(i("ac6a"),i("6b54"),i("2909")),l=(i("c5f6"),i("01ea")),s={name:"selectImage",data:function(){return{visible:!1,activeTab:"link",linkImgUrl:"",dialogImageUrl:"",dialogVisible:!1,disabled:!1,fileList:[],imgList:[],loading:!1}},props:{uploadLimit:{type:Number,default:6},value:{type:[Array,String],default:""}},methods:{show:function(){this.visible=!0},confirm:function(){switch(this.activeTab){case"link":this.linkImgUrl&&(this.imgList=[this.linkImgUrl],this.$emit("input",this.linkImgUrl));break;case"upload":this.loading=!0,this.$refs.upload.submit();break}this.visible=!1},cancel:function(){this.visible=!1},handleTabClick:function(t){},handleOnChange:function(t,e){/(gif|jpg|jpeg|png|GIF|JPG|PNG|bmp|BMP)/.test(t.raw.type)?t.raw.size/1024/1024>l["LIMIT_UPLOAD_SIZE"]&&(this.$message.error("图片大小不能超过".concat(l["LIMIT_UPLOAD_SIZE"],"MB")),e.pop()):(this.$message.error("请选择图片文件"),e.pop()),this.fileList=e},handlePictureCardPreview:function(t){this.dialogImageUrl=t.url,this.dialogVisible=!0},handleUploadSuccess:function(t,e,i){var a;console.log(t,e,i),1==this.uploadLimit?this.imgList=[t.data[0]]:(a=this.imgList).push.apply(a,Object(r["a"])(t.data)),this.imgList.length==this.fileList.length&&(this.loading=!1,this.$emit("input",1==this.uploadLimit?this.imgList[0]:this.imgList))},handleUploadFail:function(t,e,i){console.log(t),this.$message.error(t.toString()),this.loading=!1}},computed:{headers:function(){return{Authorization:"Bearer "+this.$store.state.user.token}},HOST:function(){return this.$store.state.HOST}},watch:{value:{immediate:!0,handler:function(t,e){var i=this;""!=e||this.imgList.length||this.value&&(this.value instanceof Array?this.value.forEach((function(t){i.imgList.push(t)})):this.imgList.push(this.value))}}}},o=s,u=(i("333b"),i("2877")),c=Object(u["a"])(o,a,n,!1,null,"5890adfa",null);e["a"]=c.exports},8604:function(t,e,i){"use strict";i("16b3")},cc67:function(t,e,i){"use strict";i.r(e);var a=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"articlePublish"},[i("div",{staticClass:"crumbs"},[i("el-breadcrumb",{attrs:{separator:"/"}},[i("el-breadcrumb-item",{attrs:{to:{path:"/article"}}},[t._v("文章管理")]),i("el-breadcrumb-item",[t._v(t._s("add"==t.mode?"发布":"编辑")+"文章")])],1)],1),i("div",{staticClass:"container"},[i("el-form",{ref:"articleForm",attrs:{model:t.form,"label-position":"top","label-width":"80px",rules:t.rules}},[i("el-form-item",{attrs:{label:"文章标题",prop:"title",required:""}},[i("el-col",{attrs:{span:6}},[i("el-input",{attrs:{placeholder:"请输入文章标题"},model:{value:t.form.title,callback:function(e){t.$set(t.form,"title",e)},expression:"form.title"}})],1)],1),i("el-form-item",{attrs:{label:"封面图"}},[i("selectImage",{ref:"selectImage",attrs:{uploadLimit:1},model:{value:t.form.coverImg,callback:function(e){t.$set(t.form,"coverImg",e)},expression:"form.coverImg"}})],1),i("el-form-item",{attrs:{label:"文章分类",prop:"sort",required:""}},[i("el-select",{model:{value:t.form.sort,callback:function(e){t.$set(t.form,"sort",e)},expression:"form.sort"}},t._l(t.sortList,(function(t){return i("el-option",{key:t.value,attrs:{label:t.name,value:t._id}})})),1)],1),"edit"==t.mode?i("el-form-item",{attrs:{label:"文章状态",prop:"status"}},[i("el-select",{model:{value:t.form.status,callback:function(e){t.$set(t.form,"status",e)},expression:"form.status"}},t._l(t.articleStatus,(function(t){return i("el-option",{key:t.key,attrs:{label:t.value,value:t.key}})})),1)],1):t._e(),i("el-form-item",{attrs:{label:"标签"}},[t._l(t.form.tag,(function(e){return i("el-tag",{key:e,attrs:{closable:"","disable-transitions":!1,type:"dark",size:"medium"},on:{close:function(i){return t.handleClose(e)}}},[t._v("\n                    "+t._s(e)+"\n                ")])})),t.inputVisible?i("el-input",{ref:"saveTagInput",staticClass:"input-new-tag",attrs:{size:"small",maxlength:"10",placeholder:"按下回车添加"},on:{blur:t.handleInputConfirm},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.handleInputConfirm.apply(null,arguments)}},model:{value:t.inputValue,callback:function(e){t.inputValue=e},expression:"inputValue"}}):i("el-tag",{staticClass:"button-new-tag",attrs:{type:"dark",size:"medium"},on:{click:t.showInput}},[t._v("\n                    + 添加\n                ")])],2),i("el-form-item",{attrs:{label:"摘要"}},[i("el-col",{attrs:{span:10}},[i("el-input",{attrs:{placeholder:"简单的描述文章内容"},model:{value:t.form.desc,callback:function(e){t.$set(t.form,"desc",e)},expression:"form.desc"}})],1)],1),i("el-form-item",{attrs:{label:"文章内容",prop:"content",required:""}},[i("quill-editor",{ref:"articleEditor",attrs:{options:t.editorOption},model:{value:t.form.content,callback:function(e){t.$set(t.form,"content",e)},expression:"form.content"}})],1),i("el-form-item",[i("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.submitForm("articleForm")}}},[t._v(t._s("add"==t.mode?"发布":"保存"))]),i("el-button",{on:{click:function(e){return t.resetForm("articleForm")}}},[t._v("清空")])],1)],1)],1)])},n=[],r=(i("7514"),i("a481"),i("a753"),i("8096"),i("14e1"),i("953d")),l=i("2423"),s=i("6247"),o=i("08f3"),u={tag:[],coverImg:""},c={name:"publish",data:function(){return{mode:"add",sortList:[],form:{},inputVisible:!1,inputValue:"",editorOption:{placeholder:"请自由发挥吧"},rules:{title:[{required:!0,message:"请输入文章标题",trigger:"blur"}],sort:[{required:!0,message:"请选择文章分类",trigger:"blur"}],content:[{required:!0,message:"请填写文章内容",trigger:"blur"}]},articleStatus:o["a"]}},created:function(){this.getSortList()},activated:function(){var t=this,e=this.$route.query.id;e&&!isNaN(e)?Object(l["g"])(e).then((function(e){for(var i in t.mode="edit",e.data)t.$set(t.form,i,e.data[i])})):(this.form=Object.assign({},u),this.mode="add")},methods:{submitForm:function(t){var e=this;this.$refs[t].validate((function(t){if(t){if(1==e.$refs.selectImage.loading)return e.$message.warning("请等待封面图上传完毕后发布"),e.$refs.selectImage.show();e.form.desc||(e.form.desc=e.$refs.articleEditor.quill.getText().substr(0,200));var i="add"==e.mode?l["a"]:l["f"];i(e.form).then((function(t){setTimeout((function(){e.$router.replace("/article")}),500)}))}}))},resetForm:function(t){this.$refs[t].resetFields()},getSortList:function(){var t=this;Object(l["m"])().then((function(e){t.sortList=e.data}))},handleClose:function(t){this.form.tag.splice(this.form.tag.indexOf(t),1)},showInput:function(){var t=this;this.inputVisible=!0,this.$nextTick((function(e){t.$refs.saveTagInput.$refs.input.focus()}))},handleInputConfirm:function(){var t=this.inputValue;t&&!this.form.tag.find((function(e){return e==t}))&&this.form.tag.push(t),this.inputVisible=!1,this.inputValue=""}},components:{quillEditor:r["quillEditor"],selectImage:s["a"]}},m=c,d=(i("8604"),i("2877")),f=Object(d["a"])(m,a,n,!1,null,"0b12b4f2",null);e["default"]=f.exports}}]);